This code will not run as is. It is bits put together for reading only, some function calls not included.
Please read notes first as they will make some sense of it.
